<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Like Ricevuti</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="container center-content">
    <h1>🔔 Like Ricevuti</h1>
    <div id="likes-list" class="card-grid">Caricamento...</div>

    <br>
    <a href="index.html" class="btn">🏠 Torna alla Home</a>
  </div>

  <script>
    const email = localStorage.getItem("userEmail");

    if (!email) {
      alert("Non sei loggato.");
      window.location.href = "login.html";
    }

    fetch("https://incontri-backend.onrender.com/list-users")
      .then(res => res.json())
      .then(users => {
        const list = document.getElementById("likes-list");
        list.innerHTML = "";

        const likedUsers = users.filter(u => u.likes.includes(u.nickname) === false && u.likes.includes(localStorage.getItem("userEmail")));

        const myProfile = users.find(u => u.email === email);
        const likers = users.filter(u => u.likes.includes(myProfile.nickname));

        if (likers.length === 0) {
          list.innerHTML = "<p>Nessun like ricevuto.</p>";
          return;
        }

        likers.forEach(user => {
          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <img src="${user.photo || '/images/default-profile.png'}" class="profile-photo" />
            <h3>${user.nickname}</h3>
            <a href="chat.html?receiverEmail=${user.email}" class="btn">💬 Rispondi</a>
          `;

          list.appendChild(card);
        });
      })
      .catch(err => {
        console.error("Errore caricamento like:", err);
        document.getElementById("likes-list").innerHTML = "<p>Errore durante il caricamento.</p>";
      });
  </script>
</body>
</html>

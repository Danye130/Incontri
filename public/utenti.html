<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scopri Utenti - Incontri</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container center-content">
    <h1>Utenti Registrati</h1>
    <div id="users-grid" class="card-grid"></div>

    <a href="profile.html" class="btn">Torna al Profilo</a>
  </div>

  <script>
    const myNickname = localStorage.getItem('userNickname');

    if (!myNickname) {
      alert('Devi accedere prima.');
      window.location.href = 'login.html';
    }

    function loadUsers() {
      fetch('https://incontri-backend.onrender.com/list-users')
        .then(response => response.json())
        .then(users => {
          const usersGrid = document.getElementById('users-grid');
          usersGrid.innerHTML = '';

          users.forEach(user => {
            if (user.nickname !== myNickname) { // Non mostrare se stessi
              const card = document.createElement('div');
              card.className = 'card';

              card.innerHTML = `
                <img src="${user.photo || '/images/default-profile.png'}" alt="Foto" class="profile-photo">
                <h3>${user.nickname} ${user.isVIP ? '<span class="vip-badge">VIP</span>' : ''}</h3>
                <p>${user.description || 'Nessuna descrizione'}</p>
                <button class="btn" onclick="startChat('${user.nickname}')">Chatta</button>
                <button class="btn like-btn" onclick="sendLike('${user.nickname}')">❤️ Mi Piace</button>
              `;

              usersGrid.appendChild(card);
            }
          });
        })
        .catch(err => console.error('Errore caricamento utenti:', err));
    }

    function startChat(receiverNickname) {
      window.location.href = `chat.html?receiver=${receiverNickname}`;
    }

    function sendLike(receiverNickname) {
      fetch('https://incontri-backend.onrender.com/like', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          sender: localStorage.getItem('userNickname'),
          receiver: receiverNickname
        })
      })
      .then(response => response.text())
      .then(data => {
        alert(data);
      })
      .catch(err => console.error('Errore invio like:', err));
    }

    loadUsers();
  </script>
</body>
</html>
